<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Music Hack </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
    </style>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--<script type="text/javascript" src="linesForTextarea.js"></script>-->


<script type="text/javascript">
var gSoundToy = null;
var offset = 4;

function myInit()
{
    //addLinesToTextArea('myShaderCode');

    gSoundToy = new SoundToy(null);
    if( !gSoundToy.mCreated )
        return;

    window.onkeydown = function(ev)
    {
        var note = 666;
//alert( ev.keyCode );
        //-----------------------------------
        if(   ev.keyCode==90 )  note= 0; // C 0
          if( ev.keyCode==83 )  note= 1; // C#0
        if(   ev.keyCode==88 )  note= 2; // D 0
          if( ev.keyCode==68 )  note= 3; // D#0
        if(   ev.keyCode==67 )  note= 4; // E 0
        if(   ev.keyCode==86 )  note= 5; // F 0
          if( ev.keyCode==71 )  note= 6; // F#0
        if(   ev.keyCode==66 )  note= 7; // G 0
          if( ev.keyCode==72 )  note= 8; // G#0
        if(   ev.keyCode==78 )  note= 9; // A 0
          if( ev.keyCode==74 )  note=10; // A#0
        if(   ev.keyCode==77 )  note=11; // B 0
        if(   ev.keyCode==188 ) note=12; // C 0

        //-----------------------------------
        if(   ev.keyCode==81 )  note=12; // C 1
          if( ev.keyCode==50 )  note=13; // C#1
        if(   ev.keyCode==87 )  note=14; // D 1
          if( ev.keyCode==51 )  note=15; // D#1
        if(   ev.keyCode==69 )  note=16; // E 1
        if(   ev.keyCode==82 )  note=17; // F 1
          if( ev.keyCode==53 )  note=18; // F#1
        if(   ev.keyCode==84 )  note=19; // G 1
          if( ev.keyCode==54 )  note=20; // G#1
        if(   ev.keyCode==89 )  note=21; // A 1
          if( ev.keyCode==55 )  note=22; // A#1
        if(   ev.keyCode==85 )  note=23; // B 1
        //-----------------------------------
        if( ev.keyCode==73 )    note=24; // C 2
          if( ev.keyCode==57 )  note=25; // C#2
        if( ev.keyCode==79 )    note=26; // D 2
          if( ev.keyCode==48 )  note=27; // D#2
        if( ev.keyCode==80 )    note=28; // E 2
        if(   ev.keyCode==219 ) note=29; // F 2
          if( ev.keyCode==187 ) note=30; // F#2
        if(   ev.keyCode==221 ) note=31; // G 2
        //-----------------------------------

        if( note==666 ) return;
		var k = note;
        gSoundToy.noteOn( note );
	console.log("offset="+offset);	
		switch (k) {

			case 0: 
				updateScore("c/"+offset);
				break;
			case 1: 
				updateScore("c#/"+offset);
				break;

			case 2: 
				updateScore("d/"+offset);
				break;

			case 3: 
				updateScore("d#/"+offset);
				break;

			case 4: 
				updateScore("e/"+offset);
				break;

			case 5: 
				updateScore("f/"+offset);
				break;

			case 6: 
				updateScore("f#/"+offset);
				break;

			case 7: 
				updateScore("g/"+offset);
				break;

			case 8: 
				updateScore("g#/"+offset);
				break;

			case 9: 
				updateScore("a/"+offset);
				break;

			case 10: 
				updateScore("a#/"+offset);
				break;

			case 11: 
				updateScore("b/"+offset);
				break;

			case 12: 
				updateScore("c/"+(offset+1));
				break;

			case 13: 
				updateScore("c#/"+(offset+1));
				break;

			case 14: 
				updateScore("d/"+(offset+1));
				break;

			case 15: 
				updateScore("d#/"+(offset+1));
				break;

			case 16: 
				updateScore("e/"+(offset+1));
				break;

			case 17: 
				updateScore("f/"+(offset+1));
				break;

			case 18: 
				updateScore("f#/"+(offset+1));
				break;

			case 19: 
				updateScore("g/"+(offset+1));
				break;

			case 20: 
				updateScore("g#/"+(offset+1));
				break;

			case 21: 
				updateScore("a/"+(offset+1));
				break;

			case 22: 
				updateScore("a#/"+(offset+1));
				break;

			case 23: 
				updateScore("b/"+(offset+1));
				break;

			case 24: 
				updateScore("c/"+(offset+2));
				break;

			case 25: 
				updateScore("c#/"+(offset+2));
				break;

			case 26: 
				updateScore("d/"+(offset+2));
				break;

			case 27: 
				updateScore("d#/"+(offset+2));
				break;

			case 28: 
				updateScore("e/"+(offset+2));
				break;

			case 29: 
				updateScore("f/"+(offset+2));
				break;

			case 30: 
				updateScore("f#/"+(offset+2));
				break;

			case 31: 
				updateScore("g/"+(offset+2));
				break;

			case 666: 
				break;


		}

    }


    //look in the url for the shader to be loaded
    var shadername = "piano1";
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for( var i=0; i<hashes.length; i++ )
    {
        var hash = hashes[i].split('=');
        if( hash[0] == "p" )
        {
            shadername = decodeURI(hash[1]).toLowerCase().replace(/\s/g, "");
            break;
        }
    }
    // set the combo box
    var no = document.getElementById("myPresets").options;
    for( var i=0; i<no.length; i++ )
    {
        if( no[i].value == shadername )
        {
              document.getElementById("myPresets").selectedIndex = i;
              break;
        }
    }


    var res = gSoundToy.newScript("presets/"+shadername+".xml");
}


function loadPreset()
{
    var no=document.getElementById("myPresets");
    var txt = "presets/" + no.options[no.selectedIndex].value + ".xml";

    gSoundToy.newScript( txt );
}

</script>

    <!--[if lt IE 9]>
      <script src="../js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../ico/favicon.png">
  </head>

  <body onload="myInit()">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Music Hack</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
            </ul>
            <form class="navbar-form pull-right">
            </form>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->

      <!-- Example row of columns -->
      <div class="row">
        <div class="span12">
		  <div class="input-prepend input-append">
		  <span class="add-on"><strong>Settings:</strong></span>
		  <span class="add-on">Examples:</span>
		  <select id="myPresets">
            <option value="piano1">Piano 1</option>
            <option value="piano2">Piano 2</option>
            <option value="guitar1">Guitar</option>
            <option value="flute1">Flute</option>
            <option value="drum1">Drum 1</option>
			</select>
			<input type="button" value="Load" class="btn" title="load the selected preset" onClick="loadPreset()"/>
		  </div>
		<div class="input-prepend input-append pull-right"> 
			<span class="add-on">Duration:</span>	
			<input type="text" class="userInput" id="mySoundDuration" value="1" style="width:40px" title="horizontal resolution, in pixels" onChange="javascript:gSoundToy.setDuration()">
			<span class="add-on">Volume:</span>
			<input type="text" class="userInput" id="myVolume" value="100" style="width:40px" title="horizontal resolution, in pixels" onChange="javascript:gSoundToy.setVolume()">
			<span class="add-on">Apply effects:
			<input type="checkbox" class="userInput" id="myEffects" value="384" style="width:40px" title="vertical resolution, in pixels" onChange="javascript:gSoundToy.setEffects()">
			</span>
		</div>
		</div>
      </div>
      <div class="row">
        <div class="span6">
          <h2>Graph:</h2>
		  <canvas id="graph" width="540" height="262"></canvas>

        </div>
        <div class="span6">
          <h2>Equations:</h2>
		  <div class=input-prepend input-append">
		  <span class="add-on"><strong>Enter Equation (ex. y = sin(w * t))</strong></span>
		  <input type="button" value="Load Equation" onclick="javascript:gSoundToy.newSound()" class="btn" title="load Equ. (<ALT>+<ENTER>)" id="myResetButton"/>
		  <input type="button" value="Help" title="help" class="btn" onclick="window.open('help.html','Help','width=760,height=480,status=yes,toolbar=no,scrollbars=yes')"/>

		  </div>
       <textarea rows="11"  class="span6" style="font-family:'courier';font-size:14" id="myShaderCode" wrap="off"></textarea>

       <progress id="myProgressBar" min="0" max="100" value="0" style="width:100%"></progress>

	   <textarea type="text" rows="3" cols="64" class="span6" style="font-family:'courier';font-size:14" readonly="readonly" value="" id="errorTxtBox" ></textarea>
       </div>
      </div>

      <hr>
	  <div class="row">
	  	<div class="span12">
		  <div class="input-prepend input-append">
		  	<span class="add-on"><strong>Keyboard</strong></span>
		  	<span class="add-on">         Octaves:</span>
			<label class="checkbox inline">
			<input type="radio" class="userInput" name="octave" value="0"  onChange="javascript:gSoundToy.setOctave(0); offset=3; console.log('changed offset to 1');"/> 0
			</label>
			<label class="checkbox inline">
			<input type="radio" class="userInput" name="octave" value="1"  onChange="javascript:gSoundToy.setOctave(1); offset=4; console.log('changed offset to 2');" checked/> 1
			</label>
			<label class="checkbox inline">
			<input type="radio" class="userInput" name="octave" value="2"  onChange="javascript:gSoundToy.setOctave(2); offset=5;console.log('changed offset to 4')"/> 2
			</label>
		  </div>
		  <div class="well" style="background-color:gray;">
       <canvas id="piano" width="1122" height="128"></canvas>
	      </div>
		</div>
	  </div>
	  <div class="row">
	  	<div class="span12">
			<center><canvas id="sheet" width=1200 height=300"></canvas></center>
		</div>
	  </div>
	  <script>
	  var id="IMSLP00001";
	  (function () {
	   var pnsv = document.createElement('script'); pnsv.type = 'text/javascript'; pnsv.async = true;
	   pnsv.src = 'http://pchnote.appspot.com/scoreviewer/scoreviewer.nocache.js';
	   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(pnsv);
	   })();
var _pnq = _pnq || [];
_pnq.push(['rootElement', 'PeachnoteViewerContainerId']);
_pnq.push(['loadScore', id]);
</script>
			
		<div class="row">
		<div class="span12">
		  <div id='PeachnoteViewerContainerId'></div>
		</div>
		</div>
		<div class="row">
			
		  <div class=input-prepend input-append">
		  <span class="add-on"><strong>Enter music id:</strong></span>
		  <input type="text" id="searchbox">
		  <input type="button" value="search" onclick="javascript: i_pnq.push(['loadScore', id]);" class="btn" title="id" id="search"/>
		  </div>
		</div>
      <hr>

      <footer>
        <p>&copy; Music Hack 2013</p>
      </footer>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./js/jquery.js"></script>
	<script type="text/javascript" src="./js/vexflow-min.js"></script>
	<script type="text/javascript" src="sheet.js"></script>
	<script type="text/javascript" src="lib.js"></script>

  </body>
</html>
